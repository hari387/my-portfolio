---
layout: page
---

{% for post in site.posts limit:10 %}
<h2 class="post-title">
    <a href="{{ post.url | relative_url }}">
        {{ post.title }}
    </a>
</h2>

<div class="post-meta">
    <div class="post-time">
        <i class="fa fa-calendar-alt"></i>
        <time datetime='{{ post.date | date: "%Y-%m-%d" }}'>{{ post.date | date_to_string }}</time>
    </div>
    <ul>
        {% for tag in post.tags %}
        <li><a href="{{'/tag/' | append: tag | relative_url }}">{{ tag }}</a></li>
        {% endfor %}
    </ul>
</div>

<div class="post-descr">
    <p>
        {{ post.description }}
    </p>
</div>
{% endfor %}


<div class="post-footer">
    <div class="column-full">
        <h3><a href="{{ 'archive/index.html' | relative_url }}">Blog archive</a></h3>
    </div>
    <div>
        <form id="comment-form">
            <input type="text" placeholder="Comment Here" id="new-comment" />
            <input type="button" onclick="addComment()" value="Submit" />
            <br>
            Max Comments Displayed:
            <input type="number" 
                value="10"
                min="5" 
                max="30" 
                id="max-comments" 
                onchange="fetch('../data?maxcomments=' + document.getElementById('max-comments').value).then(handleResponse);" />
            <br>
            <input type="button" onclick="deleteComments()" value="Delete Comments" />
        </form>
    </div>
    <div id='comments'>

    </div>
    <script>
        var comments = []

        function getComments(){
            fetch('../data?maxcomments=' + document.getElementById('max-comments').value).then(handleResponse);
        }

        getComments();

        function handleResponse(response){
            response.json().then((text) => comments = text).then(renderComments);
        }
        
        function renderComments(){
            document.getElementById('comments').innerHTML = "";
            for(var i = 0;i < comments.length;i++){
                document.getElementById('comments').innerHTML += comments[i] + '<br>';
            }
        }

        function deleteComments(){
            fetch('../delete-data',{method:'POST'}).then(() => getComments());
        }
        

        function addComment(){
            comment = document.getElementById('new-comment').value;
            let xhr = new XMLHttpRequest();
            xhr.open("POST", "../data");
            xhr.onreadystatechange = function () {
                if(xhr.readyState === XMLHttpRequest.DONE) {
                    fetch('../data?maxcomments=' + document.getElementById('max-comments').value).then(handleResponse);
                }
            };
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.send("comment-input=" + comment)
            document.getElementById('new-comment').value = "";
        }

        var input = document.getElementById("new-comment");

        // Execute a function when the user releases a key on the keyboard
        input.addEventListener("keydown", function(event) {
        // Number 13 is the "Enter" key on the keyboard
        if (event.keyCode === 13) {
            // Cancel the default action, if needed
            event.preventDefault();
            addComment();
        }
        });
        
    </script>
</div>
